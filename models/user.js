const mongoose = require('mongoose'),
Schema = mongoose.Schema,
bcrypt = require('bcryptjs'),
userSchema = new Schema({
    firstName: {type: String, required: true},
    lastName: {type: String, required: true},
    email: {
        type: String,
        required: true,
        unique: true,
        lowercase: true,
        validate: [emailValidator, 'incorrect mail format']
    },
    password: {
       type: String,
       required: true 
    }
});

function emailValidator(value){
    return /^.+@.+\..+$/.test(value);
}
userSchema.pre('save', async function(next){
    try{
const salt = await bcrypt.genSalt(10),
passwordHash = await bcrypt.hash(this.password, salt)
this.password = passwordHash
next()
    }catch(error){
        next(error)
    }
})

userSchema.methods.isPasswordValid = async function (value){
    try{
        return await bcrypt.compare(value, this.password)
    }catch(error){
        throw new Error(error)
    }
}
module.exports = mongoose.model('user', userSchema);